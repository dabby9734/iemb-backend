"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ValidContentExamples = void 0;
const ref_utils_1 = require("../../ref-utils");
const utils_1 = require("../utils");
const ValidContentExamples = (opts) => {
    var _a;
    const disallowAdditionalProperties = (_a = opts.disallowAdditionalProperties) !== null && _a !== void 0 ? _a : true;
    return {
        MediaType: {
            leave(mediaType, ctx) {
                const { location, resolve } = ctx;
                if (!mediaType.schema)
                    return;
                if (mediaType.example) {
                    utils_1.validateExample(mediaType.example, mediaType.schema, location.child('example'), ctx, disallowAdditionalProperties);
                }
                else if (mediaType.examples) {
                    for (const exampleName of Object.keys(mediaType.examples)) {
                        let example = mediaType.examples[exampleName];
                        let dataLoc = location.child(['examples', exampleName, 'value']);
                        if (ref_utils_1.isRef(example)) {
                            const resolved = resolve(example);
                            if (!resolved.location)
                                continue;
                            dataLoc = resolved.location.child('value');
                            example = resolved.node;
                        }
                        utils_1.validateExample(example.value, mediaType.schema, dataLoc, ctx, disallowAdditionalProperties);
                    }
                }
            },
        },
    };
};
exports.ValidContentExamples = ValidContentExamples;
